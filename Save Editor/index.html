<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incremental Game Save Editor</title>
    <link rel="stylesheet" href ="styles.css">
</head>
<body>
    <div class="container">
        <h1>Incremental Game Save Editor</h1>
        <p class="subtitle">Decode, edit, and re-encode your game save files (in Base64)<br>I DON'T CONDONE CHEATING</p>

        <div class="section">
            <label for="encodedInput">Paste your Base64 encoded save here:</label>
            <textarea id="encodedInput" placeholder="Paste your base64 save data here..."></textarea>
            <div class="error" id="decodeError">Error parsing save. Is your save corrupt?</div>
        </div>

        <div class="section">
            <button id="decodeBtn">Decode to JSON</button>
        </div>

        <div class="section">
            <label for="jsonOutput">Edit your save data (JSON):</label>
            <textarea id="jsonOutput" placeholder="Decoded JSON will appear here..."></textarea>
            <div class="error" id="jsonError">Error parsing JSON. Make sure the JSON is correctly formatted!</div>
        </div>

        <div class="section">
            <button id="encodeBtn">Encode to Base64</button>
            <button id="copyBtn">Copy to Clipboard</button>
        </div>

        <div class="section">
            <label for="encodedOutput">Base64 encoded save (ready to paste back into game):</label>
            <textarea id="encodedOutput" placeholder="Encoded save will appear here..." readonly></textarea>
            <div class="success" id="copySuccess">Copied to Clipboard!</div>
        </div>
    </div>

    <script>
        const elements = {
            encodedInput: document.getElementById('encodedInput'),
            jsonOutput: document.getElementById('jsonOutput'),
            encodedOutput: document.getElementById('encodedOutput'),
            decodeBtn: document.getElementById('decodeBtn'),
            encodeBtn: document.getElementById('encodeBtn'),
            copyBtn: document.getElementById('copyBtn'),
            decodeError: document.getElementById('decodeError'),
            jsonError: document.getElementById('jsonError'),
            copySuccess: document.getElementById('copySuccess')
        };

        const base64dict = {
            0: 'A', 1: 'B', 2: 'C', 3: 'D', 4: 'E', 5: 'F', 6: 'G', 7: 'H',
            8: 'I', 9: 'J', 10: 'K', 11: 'L', 12: 'M', 13: 'N', 14: 'O', 15: 'P',
            16: 'Q', 17: 'R', 18: 'S', 19: 'T', 20: 'U', 21: 'V', 22: 'W', 23: 'X',
            24: 'Y', 25: 'Z', 26: 'a', 27: 'b', 28: 'c', 29: 'd', 30: 'e', 31: 'f',
            32: 'g', 33: 'h', 34: 'i', 35: 'j', 36: 'k', 37: 'l', 38: 'm', 39: 'n',
            40: 'o', 41: 'p', 42: 'q', 43: 'r', 44: 's', 45: 't', 46: 'u', 47: 'v',
            48: 'w', 49: 'x', 50: 'y', 51: 'z', 52: '0', 53: '1', 54: '2', 55: '3',
            56: '4', 57: '5', 58: '6', 59: '7', 60: '8', 61: '9', 62: '+', 63: '/'
        };

        // Decode function
        elements.decodeBtn.addEventListener('click', () => {
            let input = elements.encodedInput.value;            
            let decoded = 0;
            try {
                decoded = atob(input);
            } catch (err) {
                elements.decodeError.style.display = 'block';
                console.log('Error parsing save. ' + err);
                return;
            }
            let parsed = JSON.parse(decoded);
            elements.jsonOutput.value = JSON.stringify(parsed, null, 2);
            elements.decodeError.style.display = 'none';
        });

        // Encode function
        elements.encodeBtn.addEventListener('click', () => {
            let input = elements.jsonOutput.value;
            let parsed = 0;
            try {
                parsed = JSON.parse(input);
            } catch (err) {
                elements.jsonError.style.display = 'block';
                console.log('Error parsing JSON. ' + err);
                return;
            }
            let mini = JSON.stringify(parsed);
            let encoded = btoa(mini);
            elements.encodedOutput.value = encoded;
            elements.jsonError.style.display = 'none';
        });

        // Copy to clipboard function
        elements.copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(elements.encodedOutput.value);
                elements.copySuccess.style.display = 'block';
                elements.copySuccess.style.opacity = '1';
                console.log('Save copied to clipboard');
                setTimeout(() => { // lil fade
                    elements.copySuccess.style.transition = 'opacity 1s';
                    elements.copySuccess.style.opacity = '0';
                    setTimeout(() => {
                        elements.copySuccess.style.display = 'none';
                    }, 1000); 
                }, 1000);
            } catch (err) {
                console.log('Error copying save to clipboard. ' + err);
                elements.copySuccess.style.display = 'none';
            }
        });
    </script>
</body>
</html>